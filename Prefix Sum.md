# Prefix Sum

**구간합(Prefix Sum)**은 연속적으로 나열된 수에 대하여 특정 구간에 속한 수의 합이다. 구간합 배열은 요소가 해당 인덱스 이전의 모든 요소의 합인 배열이다.



```python
[1, 2, 3, 4, 5]		# 원본 배열
[1, 3, 6, 10, 15]	# 원본 배열에 대한 구간합 배열
```



## 구간합 배열의 사용

아주 긴 끈에 줄이 여러 개 그어져있다고 하자. 나는 세번째 줄부터 끈의 길이를 구하고 싶다. 그렇다면 전체 끈의 길이에서 세번째 줄까지의 끈의 길이를 빼면 된다. 마침 처음부터 `n`번째 끈까지의 길이 `l`을 나열해놓았다.

```
n 	| 1 2 3 4 5 |
l	| 2 4 8 10 13 |
```

전체 끈의 길이 `a[5]`에서 세번째 줄까지의 끈의 길이 `a[2]`를 빼면 된다. 즉 `13 - 4 = 9`이다.



즉, 배열의 `a`번째 요소부터 `b`번째 요소의 합은 구간합 배열의 `b`번째 요소에서 `a-1`번째 요소를 뺀 것과 같다.



### 1차원의 배열과 구간합

다음 배열에 대하여 `a`번째 요소부터 `b`번째 요소까지의 합을 구하라

```python
arr = [1, 3, 5, 2, 10, 8, 9]
```



`for`문으로 요소에 접근하여 합을 구할 수 있다.

```python
sum = 0
for i in range(a-1, b):
    sum += arr[i]
```



그러나 구간이 하나가 아니라 여러 개라면 `O(n^2)`의 시간 복잡도를 가진다.

```python
scopes = [
    [1, 2],
    [4, 6],
    [2, 8]
]
sum = 0

for [a, b] in scopes:
    for i in range(a-1, b):
        sum += arr[i]
    print(f'{a}~{b}: {sum}')
    sum = 0
    
```



구간합 배열을 사용하면 `O(N)` 의 시간 복잡도로 구할 수 있다.

```python
for [a, b] in scopes:
    print(pSum[b] - pSum[a-1])
```



[예: 구간 합 구하기 4](https://github.com/leegwae/problem-solving/blob/main/prefix_sum/%EA%B5%AC%EA%B0%84_%ED%95%A9_%EA%B5%AC%ED%95%98%EA%B8%B0_4.py)



### 2차원 배열과 구간합

#### 2차원 배열의 구간합 배열 구하기

2차원 배열의 구간합 배열의 `(i, j)`번째 요소는 2차원 배열에서 `(0, 0)`부터 `(i, j)`까지의 모든 요소의 합이다.

<img src="https://user-images.githubusercontent.com/57662010/164145737-7dd5187d-87ea-41ba-8540-7dd65e6f09ca.jpg" alt="prefix_sum" style="zoom:10%;" />

즉, `초록색` 위치에서의 구간합 배열 요소는 `빨간` 직사각형과 `파란` 직사각형을 더하고, `겹치는` 정사각형을 빼고 해당 위치의 2차원 배열 요소를 더한 값이다. 한편 `빨간` 직사각형은 `(i, j-1)`에 있는 구간합 배열 요소의 값과 같고, `파란` 직사각형은 `(i-1,j)`에 있는 구간합 배열 요소의 값과 같다. 또한 `겹치는` 직사각형은 `(i-1, j-1)`에 있는 구간합 배열 요소의 값과 같다. 그렇다면 다음과 같이 정리할 수 있다.

```python
pSum[i][j] = pSum[i][j-1] + pSum[i-1][j] - pSum[i-1][j-1] + arr[i][j]
```



#### 적용하기

2차원 배열의 `(x1, y1)`부터 `(x2, y2)`에 속하는 모든 요소의 합을 구할 수 있다. 먼저 `pSum[i][j]`는 배열의 `(0,0)`부터 `(i, j)`까지의 모든 요소를 더한 값이다. 그렇다면 해당 값에서 `(x1, y1)`부터 `(x2, y2)`에 속하지 않는 요소의 합을 제하면 된다.

<img src="https://user-images.githubusercontent.com/57662010/164147026-d26a3d93-0ce5-43cf-b317-05d790b3a797.jpg" alt="prefix sum 적용하기" style="zoom:10%;" />

즉, `초록` 직사각형의 크기는 해당 위치의 구간합 배열 요소의 값에서 `빨간` 직사각형과 `파란` 직사각형을 빼고 `겹치는` 직사각형을 더한 것과 같다. `빨간` 직사각형은 `(x2, y1-1)`위치의 구간합 배열 요소의 값과 같고, `파란` 직사각형은 `(x1-1, y2)` 위치의 구간한 배열 요소의 값과 같다. `겹치는` 직사각형은 `(x1-1,y1-1)` 위치의 구간합 배열 요소의 값과 같다. 그렇다면 다음과 같이 정리할 수 있다.

```
초록색 직사각형의 크기 = pSum[x2][y2] - (pSum[x2][y1-1] + pSum[x1-1][y2] - pSum[x1-1][y1-1])
```



[예: 구간 합 구하기 5](https://github.com/leegwae/problem-solving/blob/main/prefix_sum/%EA%B5%AC%EA%B0%84_%ED%95%A9_%EA%B5%AC%ED%95%98%EA%B8%B0_5.py)

